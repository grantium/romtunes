<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RomTunes - ROM Manager</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h1>RomTunes</h1>
      </div>

      <div class="sidebar-section">
        <h3>Library</h3>
        <ul class="nav-list">
          <li class="nav-item active" data-filter="all">
            <span class="icon">üìö</span>
            <span class="label">All ROMs</span>
            <span class="count" id="total-count">0</span>
          </li>
          <li class="nav-item" data-filter="favorites">
            <span class="icon">‚≠ê</span>
            <span class="label">Favorites</span>
            <span class="count" id="favorites-count">0</span>
          </li>
        </ul>
      </div>

      <div class="sidebar-section">
        <h3>Systems</h3>
        <ul class="nav-list" id="systems-list">
          <!-- Dynamically populated -->
        </ul>
      </div>

      <div class="sidebar-footer">
        <button class="btn-primary" id="import-btn">
          <span class="icon">‚ûï</span>
          Import ROMs
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Toolbar -->
      <div class="toolbar">
        <div class="search-container">
          <input
            type="text"
            id="search-input"
            placeholder="Search ROMs..."
            class="search-input"
          />
        </div>

        <div class="toolbar-actions">
          <button class="btn-scrape" id="scrape-artwork-btn" title="Download Artwork">
            üé® Scrape Artwork
          </button>

          <button class="btn-sync" id="sync-btn" title="Sync to Device">
            üîÑ Sync
          </button>

          <select id="sort-select" class="sort-select">
            <option value="name">Name</option>
            <option value="system">System</option>
            <option value="dateAdded">Date Added</option>
            <option value="size">Size</option>
          </select>

          <div class="view-toggle">
            <button class="view-btn active" data-view="grid" title="Grid View">
              ‚äû
            </button>
            <button class="view-btn" data-view="list" title="List View">
              ‚ò∞
            </button>
          </div>

          <button class="btn-settings" id="settings-btn" title="Settings">
            ‚öôÔ∏è
          </button>
        </div>
      </div>

      <!-- Stats Bar -->
      <div class="stats-bar">
        <div class="stat">
          <span class="stat-label">Total ROMs:</span>
          <span class="stat-value" id="stat-total">0</span>
        </div>
        <div class="stat">
          <span class="stat-label">Systems:</span>
          <span class="stat-value" id="stat-systems">0</span>
        </div>
        <div class="stat">
          <span class="stat-label">Total Size:</span>
          <span class="stat-value" id="stat-size">0 MB</span>
        </div>
      </div>

      <!-- Selection Bar (shown when ROMs are selected) -->
      <div class="selection-bar" id="selection-bar" style="display: none;">
        <div class="selection-info">
          <span id="selection-count">0</span> ROMs selected
        </div>
        <div class="selection-actions">
          <button class="btn-small btn-secondary" id="select-all-btn">Select All</button>
          <button class="btn-small btn-secondary" id="deselect-all-btn">Deselect All</button>
          <button class="btn-small btn-primary" id="sync-selected-btn">
            üîÑ Sync Selected
          </button>
          <button class="btn-small btn-scrape" id="scrape-selected-btn">
            üé® Scrape Selected
          </button>
        </div>
      </div>

      <!-- ROM Grid -->
      <div class="rom-container" id="rom-container">
        <div class="empty-state" id="empty-state">
          <div class="empty-icon">üéÆ</div>
          <h2>No ROMs in Library</h2>
          <p>Click "Import ROMs" to add games to your library</p>
        </div>
      </div>
    </main>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loading-overlay">
    <div class="loading-spinner"></div>
    <p id="loading-text">Loading...</p>
  </div>

  <!-- Settings Modal -->
  <div class="modal" id="settings-modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="modal-close" id="settings-close">‚úï</button>
      </div>

      <div class="modal-tabs">
        <button class="tab-btn active" data-tab="sync">Sync Profiles</button>
        <button class="tab-btn" data-tab="artwork">Artwork</button>
        <button class="tab-btn" data-tab="scraper">Scraper</button>
      </div>

      <div class="modal-body">
        <!-- Sync Profiles Tab -->
        <div class="tab-content active" id="sync-tab">
          <p class="tab-description">
            Configure sync profiles for different handheld devices. Set the base path and customize folder mappings for each system.
          </p>

          <div id="profiles-container"></div>
        </div>

        <!-- Artwork Tab -->
        <div class="tab-content" id="artwork-tab">
          <p class="tab-description">
            Configure artwork settings and types to display in your library.
          </p>

          <div class="setting-group">
            <label class="setting-label">
              <input type="checkbox" id="artwork-enabled" checked />
              Enable Artwork Display
            </label>
          </div>

          <div class="setting-group">
            <label class="setting-label">Default Artwork Type</label>
            <select id="artwork-default-type" class="setting-select">
              <option value="boxart">Box Art</option>
              <option value="screenshot">Screenshot</option>
              <option value="banner">Banner</option>
              <option value="fanart">Fan Art</option>
            </select>
          </div>

          <div class="setting-section">
            <h3>Box Art Preferences</h3>

            <div class="setting-group">
              <label class="setting-label">Preferred Box Art Style</label>
              <select id="boxart-style" class="setting-select">
                <option value="2d">2D (Flat Front Cover)</option>
                <option value="3d">3D (Perspective Box)</option>
              </select>
              <p style="font-size: 12px; color: #888; margin-top: 4px;">
                2D artwork is better for devices with small screens. 3D artwork looks better on larger displays.
              </p>
            </div>

            <div class="setting-group">
              <label class="setting-label">Preferred Region</label>
              <select id="boxart-region" class="setting-select">
                <option value="us">North America (US)</option>
                <option value="eu">Europe (EU)</option>
                <option value="jp">Japan (JP)</option>
                <option value="wor">World/Region-Free</option>
              </select>
              <p style="font-size: 12px; color: #888; margin-top: 4px;">
                If artwork for your preferred region isn't available, other regions will be used as fallback.
              </p>
            </div>

            <div class="setting-group">
              <label class="setting-label">
                <input type="checkbox" id="boxart-download-all" />
                Download All Box Art Variants
              </label>
              <p style="font-size: 12px; color: #888; margin-left: 24px;">
                When enabled, downloads both 2D and 3D variants when scraping. Useful if you sync to multiple devices with different artwork preferences.
              </p>
            </div>

            <div class="setting-group">
              <label class="setting-label">
                <input type="checkbox" id="boxart-auto-convert" checked />
                Auto-Convert for Device Sync
              </label>
              <p style="font-size: 12px; color: #888; margin-left: 24px;">
                Automatically resize box art to match device requirements when syncing (e.g., 251x361 for GarlicOS, 400x300 for Knulli).
              </p>
            </div>
          </div>
        </div>

        <!-- Scraper Tab -->
        <div class="tab-content" id="scraper-tab">
          <p class="tab-description">
            Automatically download artwork and metadata for your ROMs from online databases.
          </p>

          <div class="setting-group">
            <label class="setting-label">
              <input type="checkbox" id="scraper-enabled" />
              Enable Artwork Scraping
            </label>
          </div>

          <div class="setting-group">
            <label class="setting-label">Scraper Provider</label>
            <select id="scraper-provider" class="setting-select">
              <option value="thegamesdb">TheGamesDB (Recommended)</option>
              <option value="screenscraper">ScreenScraper</option>
            </select>
            <p style="font-size: 12px; color: #888; margin-top: 4px;">
              Both services are free but require registration for API access.
            </p>
          </div>

          <div class="setting-group" id="thegamesdb-credentials">
            <h4 style="margin-bottom: 12px; font-size: 14px;">TheGamesDB API Key</h4>
            <p style="font-size: 12px; color: #888; margin-bottom: 12px;">
              <a href="https://forums.thegamesdb.net/viewforum.php?f=10" target="_blank" style="color: #667eea">Register for a free API key</a> at TheGamesDB forums.
              It only takes a minute and gives you access to their full database.
            </p>

            <label class="setting-label">API Key</label>
            <input type="text" id="thegamesdb-apikey" class="setting-input" placeholder="Your TheGamesDB API key" />
          </div>

          <div class="setting-group" id="screenscraper-credentials" style="display: none;">
            <h4 style="margin-bottom: 12px; font-size: 14px;">ScreenScraper Credentials</h4>
            <p style="font-size: 12px; color: #888; margin-bottom: 12px;">
              <a href="https://www.screenscraper.fr" target="_blank" style="color: #667eea">Register for free</a> at ScreenScraper.fr, then
              <a href="https://www.screenscraper.fr/forumsujets.php?suj=784" target="_blank" style="color: #667eea">apply for developer credentials</a>.
            </p>

            <label class="setting-label">Username</label>
            <input type="text" id="scraper-username" class="setting-input" placeholder="Your ScreenScraper username" />

            <label class="setting-label" style="margin-top: 8px;">Password</label>
            <input type="password" id="scraper-password" class="setting-input" placeholder="Your ScreenScraper password" />
          </div>

          <div class="setting-group">
            <button class="btn-secondary" id="test-scraper-btn">Test Connection</button>
            <span id="scraper-test-result" style="margin-left: 12px; font-size: 13px;"></span>
          </div>

          <div class="setting-group">
            <label class="setting-label">Artwork Types to Download</label>
            <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 8px;">
              <label class="setting-label">
                <input type="checkbox" id="scraper-boxart" checked />
                Box Art
              </label>
              <label class="setting-label">
                <input type="checkbox" id="scraper-screenshot" checked />
                Screenshots
              </label>
              <label class="setting-label">
                <input type="checkbox" id="scraper-banner" />
                Banners
              </label>
              <label class="setting-label">
                <input type="checkbox" id="scraper-fanart" />
                Fan Art
              </label>
            </div>
          </div>

          <div class="setting-group">
            <button class="btn-primary" id="bulk-scrape-btn">Scrape All ROMs</button>
            <p style="font-size: 12px; color: #888; margin-top: 8px;">
              Note: This will scrape artwork for all ROMs that don't have box art yet.
              ScreenScraper has rate limits, so this may take a while.
            </p>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" id="settings-cancel">Cancel</button>
        <button class="btn-primary" id="settings-save">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Sync Modal -->
  <div class="modal" id="sync-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Sync ROMs to Device</h2>
        <button class="modal-close" id="sync-close">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="setting-group">
          <label class="setting-label">Select Device Profile</label>
          <select id="sync-profile-select" class="setting-select"></select>
        </div>

        <div class="sync-options">
          <label class="setting-label">
            <input type="checkbox" id="sync-saves-check" checked />
            Sync Save Files (Two-Way)
          </label>
          <p style="font-size: 11px; color: #666; margin-left: 24px; margin-top: 4px;">
            Automatically sync save files between your library and device. Keeps the most recent version.
          </p>

          <label class="setting-label" style="margin-top: 8px;">
            <input type="checkbox" id="sync-artwork-check" />
            Sync Artwork
          </label>
        </div>

        <div class="sync-actions" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #2a2a2a;">
          <button class="btn-secondary" id="import-from-device-btn">
            üì• Import from Device
          </button>
          <p style="font-size: 11px; color: #666; margin-top: 8px;">
            Scan device for ROMs not in your library and import them.
          </p>
        </div>

        <div id="sync-status" class="sync-status"></div>
        <div id="sync-progress-container" class="sync-progress" style="display: none;">
          <div class="progress-bar">
            <div class="progress-fill" id="sync-progress-bar"></div>
          </div>
          <p id="sync-progress-text">Preparing...</p>
          <div id="sync-progress-log" class="sync-progress-log"></div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" id="sync-cancel">Cancel</button>
        <button class="btn-primary" id="sync-start">Start Sync</button>
      </div>
    </div>
  </div>

  <!-- Import from Device Modal -->
  <div class="modal" id="import-device-modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>Import ROMs from Device</h2>
        <button class="modal-close" id="import-device-close">‚úï</button>
      </div>

      <div class="modal-body">
        <div id="import-device-status" class="import-status">
          <p>Scanning device for ROMs...</p>
        </div>

        <div id="import-device-results" style="display: none;">
          <div class="import-summary" id="import-summary"></div>

          <div class="import-roms-list" style="margin-top: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <h3 style="font-size: 14px; margin: 0;">ROMs Found on Device</h3>
              <div>
                <button class="btn-small btn-secondary" id="import-select-all">Select All</button>
                <button class="btn-small btn-secondary" id="import-deselect-all">Deselect All</button>
              </div>
            </div>
            <div id="import-roms-container" class="import-roms-scroll"></div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" id="import-device-cancel">Cancel</button>
        <button class="btn-primary" id="import-device-start" disabled>Import Selected</button>
      </div>
    </div>
  </div>

  <!-- ROM Detail Modal -->
  <div class="modal" id="rom-detail-modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2 id="rom-detail-title">ROM Details</h2>
        <button class="modal-close" id="rom-detail-close">‚úï</button>
      </div>

      <div class="modal-body rom-detail-body">
        <div class="rom-detail-artwork">
          <div class="artwork-display" id="rom-artwork-display">
            <div class="artwork-placeholder">üéÆ</div>
          </div>
          <div class="artwork-actions">
            <button class="btn-small" id="import-boxart">Import Box Art</button>
            <button class="btn-small" id="import-screenshot">Import Screenshot</button>
            <button class="btn-small btn-scrape" id="scrape-rom-btn">üîç Auto-Scrape</button>
          </div>
        </div>

        <div class="rom-detail-info">
          <div class="detail-field">
            <label>Name:</label>
            <span id="detail-name"></span>
          </div>
          <div class="detail-field">
            <label>System:</label>
            <span id="detail-system"></span>
          </div>
          <div class="detail-field">
            <label>File:</label>
            <span id="detail-filename"></span>
          </div>
          <div class="detail-field">
            <label>Size:</label>
            <span id="detail-size"></span>
          </div>
          <div class="detail-field">
            <label>Path:</label>
            <span id="detail-path" class="detail-path"></span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-danger" id="rom-delete">Delete ROM</button>
        <button class="btn-secondary" id="rom-detail-cancel">Close</button>
      </div>
    </div>
  </div>

  <script src="renderer.js"></script>
  <script src="settings.js"></script>
</body>
</html>
